<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ClearCore Library: SerialCommExamples/ClearCoreCommandProtocol/ClearCoreCommandProtocol.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ClearCore Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="SdkExamples.html"><span>SDK&#160;Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SerialCommExamples/ClearCoreCommandProtocol/ClearCoreCommandProtocol.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Return to <a class="el" href="SdkExamples.html">SDK Examples for Microchip Studio</a></p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Title: ClearCoreCommandProtocol</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Objective:</span></div><div class="line"><span class="comment"> *    This example demonstrates control of various functionality of the Teknic </span></div><div class="line"><span class="comment"> *     ClearCoreI/O and motion controller, including controlling ClearPath-SD </span></div><div class="line"><span class="comment"> *     motors instep and direction mode.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> *    This example processes strings of characters formatted according to the</span></div><div class="line"><span class="comment"> *     specifications below and commands the corresponding action on a ClearCore device. </span></div><div class="line"><span class="comment"> *    This example is designed to be highly configurable to meet the requirements</span></div><div class="line"><span class="comment"> *     of a variety of applications. The protocol accepts input and sends output</span></div><div class="line"><span class="comment"> *     via USB connection by default but can be configured to accept commands from</span></div><div class="line"><span class="comment"> *     other streams - such as ClearCore&#39;s COM ports, ethernet port, or XBee</span></div><div class="line"><span class="comment"> *     connection - and sources - such as manual user input, input from a text</span></div><div class="line"><span class="comment"> *     file, or control from another device sending text commands to ClearCore.</span></div><div class="line"><span class="comment"> *    </span></div><div class="line"><span class="comment"> * Setup:</span></div><div class="line"><span class="comment"> * 0. Consult the accompanying ClearCore Command Protocol User Guide for more</span></div><div class="line"><span class="comment"> *     information on using this example project.</span></div><div class="line"><span class="comment"> *      https://teknic.com/files/downloads/ClearCoreCommandProtocol_UserGuide.pdf</span></div><div class="line"><span class="comment"> * 1. Connect ClearCore via USB to a terminal that can send and receive ASCII</span></div><div class="line"><span class="comment"> *     (standard text encoding) messages, or modify the code and connect to a</span></div><div class="line"><span class="comment"> *     different source of messages. Other ClearCore examples demonstrate</span></div><div class="line"><span class="comment"> *     communication via these alternate connection options. </span></div><div class="line"><span class="comment"> * 2. ClearPath-SD motors can be connected to connector M-0, M-1, M-2, and/or M-3.</span></div><div class="line"><span class="comment"> * 3. The connected ClearPath-SD motor(s) must be configured through the MSP software</span></div><div class="line"><span class="comment"> *    for Step and Direction mode (In MSP select Mode&gt;&gt;Step and Direction).</span></div><div class="line"><span class="comment"> * 4. The ClearPath-SD motor(s) must be set to use the HLFB mode &quot;ASG-Position</span></div><div class="line"><span class="comment"> *    w/Measured Torque&quot; with a PWM carrier frequency of 482 Hz through the MSP</span></div><div class="line"><span class="comment"> *    software (select Advanced&gt;&gt;High Level Feedback [Mode]... then choose</span></div><div class="line"><span class="comment"> *    &quot;ASG-Position w/Measured Torque&quot; from the dropdown, make sure that 482 Hz</span></div><div class="line"><span class="comment"> *    is selected in the &quot;PWM Carrier Frequency&quot; dropdown, and hit the OK</span></div><div class="line"><span class="comment"> *    button).</span></div><div class="line"><span class="comment"> * 5. Set the Input Format in MSP for &quot;Step + Direction&quot;.  </span></div><div class="line"><span class="comment"> * 6. Set the Input Resolution in MSP the same as your motor&#39;s Positioning</span></div><div class="line"><span class="comment"> *    Resolution spec if you&#39;d like the pulses sent by ClearCore to command a</span></div><div class="line"><span class="comment"> *    move of the same number of Encoder Counts, a 1:1 ratio.</span></div><div class="line"><span class="comment"> * 7. Input and output devices can be wired to connectors IO0-IO5, DI6-DI8, and/or</span></div><div class="line"><span class="comment"> *     AI9-AI12. A table summarizing the acceptable connector modes for each</span></div><div class="line"><span class="comment"> *     ClearCore connector can be found in the ClearCore manual and in the User</span></div><div class="line"><span class="comment"> *     Guide for this example. This example explicitly sets the operational mode</span></div><div class="line"><span class="comment"> *     for each connector, but these modes can be reconfigured according to the</span></div><div class="line"><span class="comment"> *     table in the manual. Be sure to consult the ClearCore manual and</span></div><div class="line"><span class="comment"> *     supplemental wiring and connection diagrams to view the operating modes</span></div><div class="line"><span class="comment"> *     for each pin and corresponding connection setups.</span></div><div class="line"><span class="comment"> *    </span></div><div class="line"><span class="comment"> * Example Command Sequences</span></div><div class="line"><span class="comment"> *  The following provides an example command sequence and corresponding behavior:</span></div><div class="line"><span class="comment"> *      e1          //enable motor1</span></div><div class="line"><span class="comment"> *      e2          //enable motor2</span></div><div class="line"><span class="comment"> *      m1 1000     // if ABSOLUTE_MOVE==1, move motor1 to absolute position 1000 steps </span></div><div class="line"><span class="comment"> *                  // if ABSOLUTE_MOVE==0, move motor1 1000 steps in the positive direction </span></div><div class="line"><span class="comment"> *      v2 -200     //move motor2 at -200 steps/s in the negative direction</span></div><div class="line"><span class="comment"> *      q2s         //query the status of motor2</span></div><div class="line"><span class="comment"> *      l3v 100     //limit motor3&#39;s velocity (of positional moves only) to 100 steps/s</span></div><div class="line"><span class="comment"> *      z1          //zero Clear&#39;s position reference for motor1 (no motion is commanded to the motor)  </span></div><div class="line"><span class="comment"> *      i6          //read the current state of connector6 (DI6)</span></div><div class="line"><span class="comment"> *      o5 1        //output a value of 1 (digital high) to connector5 (IO5)</span></div><div class="line"><span class="comment"> *      h           //display the help message</span></div><div class="line"><span class="comment"> *      </span></div><div class="line"><span class="comment"> *  The following example command sequence highlights special cases and notable behavior:</span></div><div class="line"><span class="comment"> *      v0 1000     //since motor0 has not yet been enabled, no motion will be commanded</span></div><div class="line"><span class="comment"> *      e0          //enable motor0</span></div><div class="line"><span class="comment"> *      v0 1000     //move motor0 at 1000 steps/s</span></div><div class="line"><span class="comment"> *      d0          //disable motor0. since motor0 was actively moving, motor0 will fault</span></div><div class="line"><span class="comment"> *      v0 1000     //since motor0 is in fault (disabled during motion), no motion will be commanded</span></div><div class="line"><span class="comment"> *      q1s         //query the status of motor0. since the motor is in alert, the alert status will also print</span></div><div class="line"><span class="comment"> *      f 0         //disable verbose feedback </span></div><div class="line"><span class="comment"> *      q1s         //with verbose feedback disabled, only the numerical status (and alert, in this case) </span></div><div class="line"><span class="comment"> *                  //  register(s) will print, not the full status (and alert) message</span></div><div class="line"><span class="comment"> *      c0          //clear alerts on motor0</span></div><div class="line"><span class="comment"> *      v0 1000     //move motor0 at 1000 steps/s</span></div><div class="line"><span class="comment"> *      </span></div><div class="line"><span class="comment"> *      m1 2000     //assuming ABSOLUTE_MOVE is left as default, move motor1 to absolute position 2000 steps</span></div><div class="line"><span class="comment"> *      m1 2000     //since motor1 is already at absolute position 2000 steps, no motion will be commanded</span></div><div class="line"><span class="comment"> *      z1          //define motor1&#39;s current position as the zero position </span></div><div class="line"><span class="comment"> *      m1 2000     //move motor1 to absolute position 2000, which is 2000 steps  </span></div><div class="line"><span class="comment"> *                  //  away from its freshly-zeroed current position</span></div><div class="line"><span class="comment"> *    </span></div><div class="line"><span class="comment"> * Additional Resources:</span></div><div class="line"><span class="comment"> * ** ClearCore Command Protocol User Guide:</span></div><div class="line"><span class="comment"> *     https://teknic.com/files/downloads/ClearCoreCommandProtocol_UserGuide.pdf</span></div><div class="line"><span class="comment"> * ** ClearCore Documentation:</span></div><div class="line"><span class="comment"> *      https://teknic-inc.github.io/ClearCore-library/</span></div><div class="line"><span class="comment"> * ** ClearCore Manual:</span></div><div class="line"><span class="comment"> *       https://www.teknic.com/files/downloads/clearcore_user_manual.pdf</span></div><div class="line"><span class="comment"> * ** ClearCore System Diagram and Connection Diagrams:</span></div><div class="line"><span class="comment"> *      https://www.teknic.com/files/downloads/clearcore_user_manual.pdf</span></div><div class="line"><span class="comment"> * ** ClearPath Manual (DC Power):</span></div><div class="line"><span class="comment"> *      https://www.teknic.com/files/downloads/clearpath_user_manual.pdf</span></div><div class="line"><span class="comment"> * ** ClearPath Manual (AC Power):</span></div><div class="line"><span class="comment"> *      https://www.teknic.com/files/downloads/ac_clearpath-mc-sd_manual.pdf</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Copyright (c) 2020 Teknic Inc. This work is free to use, copy and distribute under the terms of</span></div><div class="line"><span class="comment"> * the standard MIT permissive software license which can be found at https://opensource.org/licenses/MIT</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;ClearCore.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span> <span class="comment">//for atoi (ASCII to Integer) parsing utility</span></div><div class="line"></div><div class="line"><span class="comment">// specify which serial interface to use as input/output</span></div><div class="line"><span class="preprocessor">#define ioPort ConnectorUsb</span></div><div class="line"><span class="comment">// select the baud rate to match the target device.</span></div><div class="line"><span class="preprocessor">#define ioPortBaudRate  115200</span></div><div class="line"><span class="comment">// specify whether the target serial interface uses CTS/RTS flow control</span></div><div class="line"><span class="comment">//  set to true if your target device uses CTS/RTS flow control</span></div><div class="line"><span class="comment">// this is only necessary if using COM ports or XBee module (not necessary for USB)</span></div><div class="line"><span class="preprocessor">#define ioFlowControl false</span></div><div class="line"></div><div class="line"><span class="comment">// structure to hold information on the feedback messages</span></div><div class="line"><span class="keyword">struct </span>FeedbackMessage{</div><div class="line">    uint32_t number;</div><div class="line">    <span class="keywordtype">char</span> *message; </div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// feedback message numbers</span></div><div class="line"><span class="preprocessor">#define FB_COMMAND_OK                                   ( 0)    </span></div><div class="line"><span class="preprocessor">#define FB_ERR_BUFFER_OVERRUN                           ( 1)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_INPUT_INVALID_NONLETTER                  ( 2)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_MOTOR_NUM_INVALID                        ( 3)    </span></div><div class="line"><span class="preprocessor">#define FB_ERR_CONNECTOR_NUM_INVALID                    ( 4)    </span></div><div class="line"><span class="preprocessor">#define FB_ERR_CONNECTOR_MODE_INCOMPATIBLE              ( 5)</span></div><div class="line"><span class="preprocessor">#define FB_ENABLED_WAITING_ON_HLFB                      ( 6)</span></div><div class="line"><span class="preprocessor">#define FB_ENABLE_FAILURE                               ( 7)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_IO_OUTPUT                                ( 8)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_MOVE_NOT_ENABLED                         ( 9)    </span></div><div class="line"><span class="preprocessor">#define FB_ERR_MOVE_IN_ALERT                            (10)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_INVALID_QUERY_REQUEST                    (11)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_LIMIT_OUT_OF_BOUNDS                      (12)                </span></div><div class="line"><span class="preprocessor">#define FB_ERR_INVALID_LIMIT_REQUEST                    (13)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_INVALID_FEEDBACK_OPTION                  (14)</span></div><div class="line"><span class="preprocessor">#define FB_ERR_UNRECOGNIZED_COMMAND                     (15)</span></div><div class="line"><span class="preprocessor">#define FB_HELP                                         (16)</span></div><div class="line"></div><div class="line"><span class="comment">// verbose feedback messages                        </span></div><div class="line"><span class="keywordtype">char</span> *msg_command_ok = </div><div class="line">    <span class="stringliteral">&quot;Command received&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_buffer_overrun = </div><div class="line">    <span class="stringliteral">&quot;Error: input buffer overrun.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_input_invalid_nonletter = </div><div class="line">    <span class="stringliteral">&quot;Error: invalid input. Commands begin with a single letter character.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_motor_num_invalid = </div><div class="line">    <span class="stringliteral">&quot;Error: a required motor was not specified or specified incorrectly. Acceptable motor numbers are 0, 1, 2, and 3.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_connector_num_invalid = </div><div class="line">    <span class="stringliteral">&quot;Error: a required connector was not specified or specified incorrectly. Acceptable connector numbers are 0 through 12, inclusive.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_io_output = </div><div class="line">    <span class="stringliteral">&quot;Error: an I/O output parameter is invalid. Ensure the output value is appropriate for the type of output pin.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_connector_mode_incompatible = </div><div class="line">    <span class="stringliteral">&quot;Error: a specified connector is of an inappropriate mode. Verify the I/O connector is configured as necessary.&quot;</span>; </div><div class="line"><span class="keywordtype">char</span> *msg_enabled_waiting_on_hlfb = </div><div class="line">    <span class="stringliteral">&quot;Motor enabled; waiting on HLFB to assert before accepting other commands.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_enable_failure = </div><div class="line">    <span class="stringliteral">&quot;Motor failed to enable due to motor fault, loss of power, or loss/absence of connection. Motor disabled.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_move_not_enabled = </div><div class="line">    <span class="stringliteral">&quot;Error: motion commanded while motor not enabled. Command e# to enable motor number #.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_move_in_alert = </div><div class="line">    <span class="stringliteral">&quot;Error: motion commanded while motor in fault. Command c# to clear alerts on motor number #.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_invalid_query_request = </div><div class="line">    <span class="stringliteral">&quot;Error: invalid query request. Command h for more information.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_limit_out_of_bounds = </div><div class="line">    <span class="stringliteral">&quot;Error: commanded limit falls outside the acceptable bounds for this limit.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_invalid_limit_request = </div><div class="line">    <span class="stringliteral">&quot;Error: invalid limit request. Command h for more information.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_invalid_feedback_option = </div><div class="line">    <span class="stringliteral">&quot;Error: invalid feedback request. Command h for more information.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_err_unrecognized_command = </div><div class="line">    <span class="stringliteral">&quot;Error: unrecognized command. Command h for more information.&quot;</span>;</div><div class="line"><span class="keywordtype">char</span> *msg_help = </div><div class="line">      <span class="stringliteral">&quot;ClearCore Command Protocol\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;Acceptable commands, where # specifies a motor number* (0, 1, 2, or 3): \n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    e#              | enable specified motor\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    d#              | disable specified motor\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    m# distance     | if(ABSOLUTE_MOVE==1) move to the specified position\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                      if(ABSOLUTE_MOVE==0) move the specified number of steps\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    v# velocity     | move at the specified velocity (steps/s)\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    q#&lt;p/v/s&gt;       | query specified motor&#39;s position/velocity/status\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    l#&lt;v/a&gt; limit   | set specified motor&#39;s velocity/acceleration limit\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    c#              | clear alerts\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    z#              | set the zero position for motor # to the current commanded position\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    i#              | read input on pin #\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        Digital pins return 1 or 0; analog pins return [0,4095] corresponding to [0,10]V\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        (*note that # for this command can be 0 through 5)\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    o# outputVal    | write output on pin #\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        Digital pins allow 1 or 0; analog pins allow [409,2047] corresponding to [4,20]mA\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        (*note that # for this command can be 0 through 12)\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    f fdbkType      | specify the type of feedback printed:\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        0  : send message number only\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;                        1  : send verbose message\n&quot;</span></div><div class="line">      <span class="stringliteral">&quot;    h               | print this help message\n&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">// array of feedback messages, accessed by SendFeedback() when feedback is sent </span></div><div class="line">FeedbackMessage FeedbackMessages[17] = {</div><div class="line">    {FB_COMMAND_OK                  ,   msg_command_ok                      },</div><div class="line">    {FB_ERR_BUFFER_OVERRUN          ,   msg_err_buffer_overrun              },</div><div class="line">    {FB_ERR_INPUT_INVALID_NONLETTER ,   msg_err_input_invalid_nonletter     },</div><div class="line">    {FB_ERR_MOTOR_NUM_INVALID       ,   msg_err_motor_num_invalid           },</div><div class="line">    {FB_ERR_CONNECTOR_NUM_INVALID   ,   msg_err_connector_num_invalid       },</div><div class="line">    {FB_ERR_CONNECTOR_MODE_INCOMPATIBLE,    </div><div class="line">                                        msg_err_connector_mode_incompatible },</div><div class="line">    {FB_ENABLED_WAITING_ON_HLFB     ,   msg_enabled_waiting_on_hlfb         },</div><div class="line">    {FB_ENABLE_FAILURE              ,   msg_enable_failure                  },</div><div class="line">    {FB_ERR_IO_OUTPUT               ,   msg_err_io_output                   },</div><div class="line">    {FB_ERR_MOVE_NOT_ENABLED        ,   msg_err_move_not_enabled            },</div><div class="line">    {FB_ERR_MOVE_IN_ALERT           ,   msg_err_move_in_alert               },</div><div class="line">    {FB_ERR_INVALID_QUERY_REQUEST   ,   msg_err_invalid_query_request       },</div><div class="line">    {FB_ERR_LIMIT_OUT_OF_BOUNDS     ,   msg_err_limit_out_of_bounds         },</div><div class="line">    {FB_ERR_INVALID_LIMIT_REQUEST   ,   msg_err_invalid_limit_request       },</div><div class="line">    {FB_ERR_INVALID_FEEDBACK_OPTION ,   msg_err_invalid_feedback_option     },</div><div class="line">    {FB_ERR_UNRECOGNIZED_COMMAND    ,   msg_err_unrecognized_command        },</div><div class="line">    {FB_HELP                        ,   msg_help                            }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// global variable to select between printing only feedback number or verbose feedback message</span></div><div class="line"><span class="keywordtype">bool</span> verboseFeedback = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="comment">// macro to select between commanding absolute positional moves or relative </span></div><div class="line"><span class="comment">//  positional moves. See User Guide for more information.                                          </span></div><div class="line"><span class="preprocessor">#define ABSOLUTE_MOVE (1)</span></div><div class="line"></div><div class="line"><span class="comment">// container for the char stream to be read-in. </span></div><div class="line"><span class="comment">//  allows for IN_BUFFER_LEN characters to be stored followed by a NULL terminator </span></div><div class="line"><span class="comment">//todo thoughts on this?</span></div><div class="line"><span class="preprocessor">#define IN_BUFFER_LEN 32</span></div><div class="line"><span class="keywordtype">char</span> input[IN_BUFFER_LEN+1];</div><div class="line"></div><div class="line"><span class="comment">// motor connectors</span></div><div class="line">MotorDriver *<span class="keyword">const</span> motors[<a name="a0"></a><a class="code" href="_sys_connectors_8h.html#af2abd7f62b1c7dbb95923d8ff8e0083e">MOTOR_CON_CNT</a>] = {</div><div class="line">    &amp;<a class="code" href="namespace_clear_core.html#a77eb80cb3ee806db95908517f4106540">ConnectorM0</a>, &amp;<a class="code" href="namespace_clear_core.html#a7ed682101224192a7930b1f06b819b41">ConnectorM1</a>, &amp;<a class="code" href="namespace_clear_core.html#a486109776226123701159ef889c79a3c">ConnectorM2</a>, &amp;<a class="code" href="namespace_clear_core.html#abc9c8fba46504d576921cf750c0b735f">ConnectorM3</a></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// I/O connectors</span></div><div class="line">Connector *<span class="keyword">const</span> connectors[13] = {</div><div class="line">    &amp;<a class="code" href="namespace_clear_core.html#a128cc767cec5a436cf33b126d17b3ff1">ConnectorIO0</a>, &amp;<a class="code" href="namespace_clear_core.html#a7077093ca9c3558a4a1009df786388f6">ConnectorIO1</a>, &amp;<a class="code" href="namespace_clear_core.html#aee9dd88176cc8f5127c1b8e326dbbfb6">ConnectorIO2</a>, &amp;<a class="code" href="namespace_clear_core.html#a5f8727eeb341752bd1d02efb25e0b689">ConnectorIO3</a>, &amp;<a class="code" href="namespace_clear_core.html#a7a51929d525d80a76c82935af736387f">ConnectorIO4</a>, &amp;<a class="code" href="namespace_clear_core.html#aa1949cc6e0cf6476095f52a6e3988937">ConnectorIO5</a>, </div><div class="line">    &amp;<a class="code" href="namespace_clear_core.html#a525ef459949089213d761d2d5c392418">ConnectorDI6</a>, &amp;<a class="code" href="namespace_clear_core.html#af52b982d1d35d573b1416f5df5e8a906">ConnectorDI7</a>, &amp;<a class="code" href="namespace_clear_core.html#af6ac1c7e9f1893972b2fe41c91525e85">ConnectorDI8</a>,</div><div class="line">    &amp;<a class="code" href="namespace_clear_core.html#a688d1f65561430b17070a5955c05b3a8">ConnectorA9</a>, &amp;<a class="code" href="namespace_clear_core.html#a0cd9cacf1c700aae528d544557c6c11c">ConnectorA10</a>, &amp;<a class="code" href="namespace_clear_core.html#ad740c3e2950089e3aed3674977409071">ConnectorA11</a>, &amp;<a class="code" href="namespace_clear_core.html#a27525d7f79b3bf1927288ed22dada355">ConnectorA12</a></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// acceleration and velocity limit bounds </span></div><div class="line"><span class="comment">// (note that velocity limits take effect only on positional moves)</span></div><div class="line"><span class="preprocessor">#define DEFAULT_ACCEL_LIMIT (100000) // pulses per sec^2</span></div><div class="line"><span class="preprocessor">#define MAX_ACCEL_LIMIT (1000000000) </span></div><div class="line"><span class="preprocessor">#define MIN_ACCEL_LIMIT (1)</span></div><div class="line"><span class="preprocessor">#define DEFAULT_VEL_LIMIT (10000) // pulses per sec</span></div><div class="line"><span class="preprocessor">#define MAX_VEL_LIMIT   (500000)</span></div><div class="line"><span class="preprocessor">#define MIN_VEL_LIMIT   (1)</span></div><div class="line"></div><div class="line"><span class="comment">// helper functions to print feedback and status information</span></div><div class="line"><span class="comment">// the implementations of these functions are at the bottom of this example</span></div><div class="line"><span class="keywordtype">void</span> SendFeedback(int32_t messageNumber);</div><div class="line"><span class="keywordtype">void</span> SendVerboseStatus(int32_t motorNumber);</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line"></div><div class="line">    <span class="comment">// configure serial communication to USB port and wait for the port to open</span></div><div class="line">    ioPort.Mode(Connector::USB_CDC);    </div><div class="line">    ioPort.Speed(ioPortBaudRate);</div><div class="line">    <span class="comment">// ioPort.FlowControl(ioFlowControl); //only necessary if using COM ports or XBee module</span></div><div class="line">    ioPort.PortOpen();</div><div class="line">    <span class="keywordflow">while</span> (!ioPort) {</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="comment">// configure input clocking rate</span></div><div class="line">    <span class="comment">// this normal rate is ideal for ClearPath step and direction applications</span></div><div class="line">    <a class="code" href="namespace_clear_core.html#a97a3a19df86a0a9f9998e4865a9bb9bb">MotorMgr</a>.<a name="a1"></a><a class="code" href="class_clear_core_1_1_motor_manager.html#a5fa7738d6ae98918ac97a7b72c6aba3e">MotorInputClocking</a>(MotorManager::CLOCK_RATE_NORMAL);</div><div class="line"></div><div class="line">    <span class="comment">// set all motor connectors into step and direction mode</span></div><div class="line">    <a class="code" href="namespace_clear_core.html#a97a3a19df86a0a9f9998e4865a9bb9bb">MotorMgr</a>.<a name="a2"></a><a class="code" href="class_clear_core_1_1_motor_manager.html#a93ccdd91df7ac566da0b55b07029b3ef">MotorModeSet</a>(MotorManager::MOTOR_ALL, Connector::CPM_MODE_STEP_AND_DIR);</div><div class="line">    </div><div class="line">    <span class="comment">// local storage for velocity and acceleration limits</span></div><div class="line">    <span class="comment">// (note that velocity limits only take effect on positional moves)</span></div><div class="line">    uint32_t accelerationLimits[<a class="code" href="_sys_connectors_8h.html#af2abd7f62b1c7dbb95923d8ff8e0083e">MOTOR_CON_CNT</a>] = { </div><div class="line">        DEFAULT_ACCEL_LIMIT, DEFAULT_ACCEL_LIMIT, DEFAULT_ACCEL_LIMIT, DEFAULT_ACCEL_LIMIT</div><div class="line">    };</div><div class="line">    uint32_t velocityLimits[<a class="code" href="_sys_connectors_8h.html#af2abd7f62b1c7dbb95923d8ff8e0083e">MOTOR_CON_CNT</a>] = { </div><div class="line">        DEFAULT_VEL_LIMIT, DEFAULT_VEL_LIMIT, DEFAULT_VEL_LIMIT, DEFAULT_VEL_LIMIT</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">// generic iterator</span></div><div class="line">    uint32_t i;</div><div class="line">    </div><div class="line">    <span class="comment">// configure all motor connectors for bipolar PWM HLFB mode at 482Hz, and set </span></div><div class="line">    <span class="comment">//  velocity and acceleration limits</span></div><div class="line">    <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="_sys_connectors_8h.html#af2abd7f62b1c7dbb95923d8ff8e0083e">MOTOR_CON_CNT</a>; i++){</div><div class="line">        motors[i]-&gt;HlfbMode(MotorDriver::HLFB_MODE_HAS_BIPOLAR_PWM);</div><div class="line">        motors[i]-&gt;HlfbCarrier(MotorDriver::HLFB_CARRIER_482_HZ);</div><div class="line">        motors[i]-&gt;VelMax(velocityLimits[i]);</div><div class="line">        motors[i]-&gt;AccelMax(accelerationLimits[i]);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// configure I/O pins</span></div><div class="line">    <span class="comment">//  these defaults can be modified according to application needs</span></div><div class="line">    <span class="comment">//  for more information and to view a list of configurable modes for each pin, </span></div><div class="line">    <span class="comment">//  see the ClearCore manual or the User Guide for this example</span></div><div class="line">    <a class="code" href="namespace_clear_core.html#a128cc767cec5a436cf33b126d17b3ff1">ConnectorIO0</a>.<a name="a3"></a><a class="code" href="class_clear_core_1_1_digital_in_out_analog_out.html#aba915648fc4f95b896bfa3040894fa86">Mode</a>(Connector::OUTPUT_ANALOG );</div><div class="line">    <a class="code" href="namespace_clear_core.html#a7077093ca9c3558a4a1009df786388f6">ConnectorIO1</a>.<a name="a4"></a><a class="code" href="class_clear_core_1_1_digital_in_out.html#a325375d09f0846e797a2e186301ddaa1">Mode</a>(Connector::OUTPUT_DIGITAL);</div><div class="line">    <a class="code" href="namespace_clear_core.html#aee9dd88176cc8f5127c1b8e326dbbfb6">ConnectorIO2</a>.<a class="code" href="class_clear_core_1_1_digital_in_out.html#a325375d09f0846e797a2e186301ddaa1">Mode</a>(Connector::OUTPUT_DIGITAL);</div><div class="line">    <a class="code" href="namespace_clear_core.html#a5f8727eeb341752bd1d02efb25e0b689">ConnectorIO3</a>.<a class="code" href="class_clear_core_1_1_digital_in_out.html#a325375d09f0846e797a2e186301ddaa1">Mode</a>(Connector::OUTPUT_DIGITAL);</div><div class="line">    <a class="code" href="namespace_clear_core.html#a7a51929d525d80a76c82935af736387f">ConnectorIO4</a>.<a name="a5"></a><a class="code" href="class_clear_core_1_1_digital_in_out_h_bridge.html#af284c59eb893b5989bff2e76d71ad1db">Mode</a>(Connector::OUTPUT_DIGITAL);</div><div class="line">    <a class="code" href="namespace_clear_core.html#aa1949cc6e0cf6476095f52a6e3988937">ConnectorIO5</a>.<a class="code" href="class_clear_core_1_1_digital_in_out_h_bridge.html#af284c59eb893b5989bff2e76d71ad1db">Mode</a>(Connector::OUTPUT_DIGITAL);</div><div class="line">    <a class="code" href="namespace_clear_core.html#a525ef459949089213d761d2d5c392418">ConnectorDI6</a>.<a name="a6"></a><a class="code" href="class_clear_core_1_1_digital_in.html#a52d60a9918ab292e0419073ada0fabe8">Mode</a>(Connector::INPUT_DIGITAL );</div><div class="line">    <a class="code" href="namespace_clear_core.html#af52b982d1d35d573b1416f5df5e8a906">ConnectorDI7</a>.<a class="code" href="class_clear_core_1_1_digital_in.html#a52d60a9918ab292e0419073ada0fabe8">Mode</a>(Connector::INPUT_DIGITAL );</div><div class="line">    <a class="code" href="namespace_clear_core.html#af6ac1c7e9f1893972b2fe41c91525e85">ConnectorDI8</a>.<a class="code" href="class_clear_core_1_1_digital_in.html#a52d60a9918ab292e0419073ada0fabe8">Mode</a>(Connector::INPUT_DIGITAL );</div><div class="line">    <a class="code" href="namespace_clear_core.html#a688d1f65561430b17070a5955c05b3a8">ConnectorA9</a> .<a name="a7"></a><a class="code" href="class_clear_core_1_1_digital_in_analog_in.html#a6648d379ed6d5d995bb075995779ee82">Mode</a>(Connector::INPUT_ANALOG  );</div><div class="line">    <a class="code" href="namespace_clear_core.html#a0cd9cacf1c700aae528d544557c6c11c">ConnectorA10</a>.<a class="code" href="class_clear_core_1_1_digital_in_analog_in.html#a6648d379ed6d5d995bb075995779ee82">Mode</a>(Connector::INPUT_ANALOG  );</div><div class="line">    <a class="code" href="namespace_clear_core.html#ad740c3e2950089e3aed3674977409071">ConnectorA11</a>.<a class="code" href="class_clear_core_1_1_digital_in_analog_in.html#a6648d379ed6d5d995bb075995779ee82">Mode</a>(Connector::INPUT_ANALOG  );</div><div class="line">    <a class="code" href="namespace_clear_core.html#a27525d7f79b3bf1927288ed22dada355">ConnectorA12</a>.<a class="code" href="class_clear_core_1_1_digital_in_analog_in.html#a6648d379ed6d5d995bb075995779ee82">Mode</a>(Connector::INPUT_ANALOG  );</div><div class="line">    </div><div class="line">    <span class="comment">// program control variables</span></div><div class="line">    <span class="keywordtype">bool</span> inputValid;</div><div class="line">    <span class="keywordtype">bool</span> motorNumValid;</div><div class="line">    <span class="keywordtype">bool</span> connectorNumValid;</div><div class="line">    <span class="keywordtype">bool</span> motorEnabledBeforeClearingAlerts;</div><div class="line">    </div><div class="line">    <span class="comment">// parsing variables</span></div><div class="line">    int32_t motorNum_in; </div><div class="line">    int32_t connectorNum_in; </div><div class="line">    int32_t moveDistance_in;</div><div class="line">    int32_t velocity_in;</div><div class="line">    int32_t limit_in; </div><div class="line">    int32_t queriedValue;</div><div class="line">    int16_t inputConnectorValue;</div><div class="line">    int16_t outputConnectorValue_in;</div><div class="line"></div><div class="line">    ioPort.SendLine(<span class="stringliteral">&quot;Setup successful&quot;</span>);</div><div class="line">    ioPort.SendLine(<span class="stringliteral">&quot;Send &#39;h&#39; to receive a list of valid commands&quot;</span>); </div><div class="line"></div><div class="line">    <span class="comment">// main loop to read and process input</span></div><div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"></div><div class="line">        <span class="comment">// reset the input buffer by populating each index with a NULL character</span></div><div class="line">        <span class="keywordflow">for</span> (i = 0; i&lt;IN_BUFFER_LEN+1; i++){</div><div class="line">            input[i] = (char) NULL;</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">// read and store the input character by character</span></div><div class="line">        <span class="comment">// input buffer has a default maximum size, defined by IN_BUFFER_LEN, of 32. </span></div><div class="line">        <span class="comment">// if more characters are provided by the user, program will reject input.</span></div><div class="line">        inputValid = <span class="keyword">true</span>;</div><div class="line">        i = 0;</div><div class="line">        <span class="keywordflow">while</span>(i&lt;IN_BUFFER_LEN &amp;&amp; ioPort.CharPeek() != -1){</div><div class="line">            input[i] = (char) ioPort.CharGet();</div><div class="line">            i++;</div><div class="line">            <a name="a8"></a><a class="code" href="_sys_timing_8h.html#a1d3146414c54513a72a7596c2f884c07">Delay_ms</a>(1);</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">//-------------------------</span></div><div class="line">        <span class="comment">// This line divides the command reading and storing section of the code from </span></div><div class="line">        <span class="comment">//  the command parsing section of the code. To use this protocol to accept commands</span></div><div class="line">        <span class="comment">//  from another source than the default USB input, ensure that the command is stored</span></div><div class="line">        <span class="comment">//  in a character array called &quot;input&quot; and is ready to be parsed after this line.</span></div><div class="line">        <span class="comment">//-------------------------</span></div><div class="line"></div><div class="line">        <span class="comment">// echo nonempty input when in verbose feedback mode</span></div><div class="line">        <span class="keywordflow">if</span>(verboseFeedback &amp;&amp; i!=0){</div><div class="line">            ioPort.SendLine(input);</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (i==0){</div><div class="line">            <span class="comment">// user did not input any characters. input invalid, but no need to report </span></div><div class="line">            inputValid = <span class="keyword">false</span>;</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ioPort.CharPeek()!=-1){ </div><div class="line">            <span class="comment">// buffer overflow (there is no space left in the buffer, but there are still characters to read from ioPort)</span></div><div class="line">            <span class="comment">// report error, reject input, and flush input stream (so the leftover characters aren&#39;t read as part of the next command)</span></div><div class="line">            SendFeedback(FB_ERR_BUFFER_OVERRUN);</div><div class="line">            inputValid = <span class="keyword">false</span>;</div><div class="line">            <span class="keywordflow">while</span>(ioPort.CharPeek()!=-1){</div><div class="line">                ioPort.FlushInput();</div><div class="line">                <a class="code" href="_sys_timing_8h.html#a1d3146414c54513a72a7596c2f884c07">Delay_ms</a>(10);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="comment">// verify first character of command is a letter</span></div><div class="line">        <span class="keywordflow">if</span> (inputValid){</div><div class="line">            <span class="keywordflow">if</span> ((<span class="charliteral">&#39;A&#39;</span> &lt;= input[0] &amp;&amp; input[0] &lt;= <span class="charliteral">&#39;Z&#39;</span>) || (<span class="charliteral">&#39;a&#39;</span> &lt;= input[0] &amp;&amp; input[0] &lt;= <span class="charliteral">&#39;z&#39;</span>)){</div><div class="line">                <span class="comment">// if letter is uppercase, convert to lowercase</span></div><div class="line">                <span class="keywordflow">if</span> (<span class="charliteral">&#39;A&#39;</span> &lt;= input[0] &amp;&amp; input[0] &lt;= <span class="charliteral">&#39;Z&#39;</span>){</div><div class="line">                    <span class="comment">// to convert an ASCII character from upper to lower case, add 32 to the character</span></div><div class="line">                    input[0] += 32; </div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                <span class="comment">// if first letter of command is not letter, reject input</span></div><div class="line">                SendFeedback(FB_ERR_INPUT_INVALID_NONLETTER);</div><div class="line">                inputValid = <span class="keyword">false</span>;</div><div class="line">                ioPort.FlushInput();</div><div class="line">            }</div><div class="line">        }</div><div class="line">        </div><div class="line">        <span class="keywordflow">if</span> (inputValid){</div><div class="line"></div><div class="line">            <span class="comment">// store and validate motor number input from command</span></div><div class="line">            motorNum_in = atoi(&amp;input[1]); </div><div class="line">            motorNumValid = (0&lt;=motorNum_in &amp;&amp; motorNum_in&lt;=3 &amp;&amp; input[1]!=NULL);</div><div class="line">            </div><div class="line">            <span class="comment">// store and validate connector number input from command</span></div><div class="line">            connectorNum_in = atoi(&amp;input[1]); </div><div class="line">            connectorNumValid = (0&lt;=connectorNum_in &amp;&amp; connectorNum_in&lt;=12 &amp;&amp; input[1]!=NULL);</div><div class="line">            </div><div class="line">            <span class="comment">// status register for accessing motor status information</span></div><div class="line">            <span class="keyword">volatile</span> <span class="keyword">const</span> MotorDriver::StatusRegMotor &amp;statusReg = motors[motorNum_in]-&gt;StatusReg();</div><div class="line">            <span class="keyword">volatile</span> <span class="keyword">const</span> MotorDriver::AlertRegMotor  &amp;alertReg  = motors[motorNum_in]-&gt;AlertReg();</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">// process the command based on the command letter (first character of input)</span></div><div class="line">            <span class="keywordflow">switch</span>(input[0]){</div><div class="line">                            </div><div class="line">                <span class="comment">// enable </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        <span class="comment">// enable the motor</span></div><div class="line">                        motors[motorNum_in]-&gt;EnableRequest(<span class="keyword">true</span>);</div><div class="line">                        SendFeedback(FB_ENABLED_WAITING_ON_HLFB);</div><div class="line">                        <span class="comment">// wait until motor is ready before accepting other commands </span></div><div class="line">                        <span class="comment">//  (allows any automatic homing move to complete if configured)</span></div><div class="line">                        <span class="comment">//  (loop will exit on fault during homing, or if motor is disconnected or loses power)</span></div><div class="line">                        <span class="keywordflow">while</span> (statusReg.bit.HlfbState != MotorDriver::HLFB_ASSERTED &amp;&amp;</div><div class="line">                                !statusReg.bit.MotorInFault){</div><div class="line">                            <span class="keywordflow">continue</span>;</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">if</span>(statusReg.bit.MotorInFault){</div><div class="line">                            <span class="comment">// if there is a fault while trying to enable, disable and report</span></div><div class="line">                            motors[motorNum_in]-&gt;EnableRequest(<span class="keyword">false</span>);</div><div class="line">                            SendFeedback(FB_ENABLE_FAILURE);</div><div class="line">                        } <span class="keywordflow">else</span> {</div><div class="line">                            SendFeedback(FB_COMMAND_OK);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>; </div><div class="line"></div><div class="line">                <span class="comment">// disable</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        <span class="comment">// disable the motor</span></div><div class="line">                        motors[motorNum_in]-&gt;EnableRequest(<span class="keyword">false</span>);</div><div class="line">                        SendFeedback(FB_COMMAND_OK);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                    </div><div class="line">                <span class="comment">// position move </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>: </div><div class="line">                    <span class="comment">// verify motor number valid, motor enabled, and no faults present</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( statusReg.bit.ReadyState==MotorDriver::MOTOR_DISABLED || </div><div class="line">                                    statusReg.bit.ReadyState==MotorDriver::MOTOR_ENABLING){</div><div class="line">                        SendFeedback(FB_ERR_MOVE_NOT_ENABLED);</div><div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (motors[motorNum_in]-&gt;StatusReg().bit.AlertsPresent) {</div><div class="line">                        SendFeedback(FB_ERR_MOVE_IN_ALERT);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        <span class="comment">// command the move</span></div><div class="line">                        <span class="comment">// #define ABSOLUTE_MOVE (0) commands absolute moves.</span></div><div class="line">                        <span class="comment">// #define ABSOLUTE_MOVE (1) commands relative moves.</span></div><div class="line">                        <span class="comment">// absolute moves are configured by default.</span></div><div class="line">                        <span class="comment">// See User Guide for more information.</span></div><div class="line">                        moveDistance_in = atoi(&amp;input[2]);      </div><div class="line">                        <span class="keywordflow">if</span> (ABSOLUTE_MOVE){</div><div class="line">                            motors[motorNum_in]-&gt;Move(moveDistance_in, MotorDriver::MOVE_TARGET_ABSOLUTE);</div><div class="line">                        } <span class="keywordflow">else</span> {</div><div class="line">                            motors[motorNum_in]-&gt;Move(moveDistance_in);</div><div class="line">                        }               </div><div class="line">                        SendFeedback(FB_COMMAND_OK);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="comment">// velocity move </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: </div><div class="line">                    <span class="comment">// verify motor number valid, motor enabled, and no faults present</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( statusReg.bit.ReadyState==MotorDriver::MOTOR_DISABLED ||</div><div class="line">                                    statusReg.bit.ReadyState==MotorDriver::MOTOR_ENABLING){</div><div class="line">                        SendFeedback(FB_ERR_MOVE_NOT_ENABLED);</div><div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (motors[motorNum_in]-&gt;StatusReg().bit.AlertsPresent) {</div><div class="line">                        SendFeedback(FB_ERR_MOVE_IN_ALERT);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        <span class="comment">// command the move</span></div><div class="line">                        velocity_in = atoi(&amp;input[2]);</div><div class="line">                        motors[motorNum_in]-&gt;MoveVelocity(velocity_in);</div><div class="line">                        SendFeedback(FB_COMMAND_OK);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                </div><div class="line">                <span class="comment">// query position, velocity, or status</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">switch</span>(input[2]){</div><div class="line">                        <span class="comment">// query commanded position </span></div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:</div><div class="line">                            <span class="comment">// send commanded position. </span></div><div class="line">                            <span class="comment">// this can differ from the position counter in MSP if the ClearCore </span></div><div class="line">                            <span class="comment">//  position reference has not been synced with ClearPath&#39;s position</span></div><div class="line">                            queriedValue = (int32_t) motors[motorNum_in]-&gt;PositionRefCommanded();</div><div class="line">                            <span class="keywordflow">if</span> (verboseFeedback){</div><div class="line">                                ioPort.Send(<span class="stringliteral">&quot;Motor &quot;</span>);</div><div class="line">                                ioPort.Send(motorNum_in);</div><div class="line">                                ioPort.Send(<span class="stringliteral">&quot; is in position (steps) &quot;</span>);</div><div class="line">                            }</div><div class="line">                            ioPort.SendLine(queriedValue);</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                            </div><div class="line">                        <span class="comment">// query velocity</span></div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div><div class="line">                            <span class="comment">// send motor velocity</span></div><div class="line">                            queriedValue = motors[motorNum_in]-&gt;VelocityRefCommanded();</div><div class="line">                            <span class="keywordflow">if</span> (verboseFeedback){</div><div class="line">                                ioPort.Send(<span class="stringliteral">&quot;Motor &quot;</span>);</div><div class="line">                                ioPort.Send(motorNum_in);</div><div class="line">                                ioPort.Send(<span class="stringliteral">&quot; is at velocity (steps/s) &quot;</span>);</div><div class="line">                            }</div><div class="line">                            ioPort.SendLine(queriedValue);</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                            </div><div class="line">                        <span class="comment">// query status </span></div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:</div><div class="line">                            <span class="comment">// send motor status</span></div><div class="line">                            <span class="keywordflow">if</span> (verboseFeedback){</div><div class="line">                                SendVerboseStatus(motorNum_in);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                ioPort.SendLine(statusReg.reg, 2);  <span class="comment">// prints the status register in binary</span></div><div class="line">                                <span class="keywordflow">if</span> (statusReg.bit.AlertsPresent){</div><div class="line">                                    ioPort.SendLine(alertReg.reg, 2); <span class="comment">// prints the alert register in binary</span></div><div class="line">                                }</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                        </div><div class="line">                        <span class="comment">// invalid query request</span></div><div class="line">                        <span class="keywordflow">default</span>:</div><div class="line">                            SendFeedback(FB_ERR_INVALID_QUERY_REQUEST);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                </div><div class="line">                <span class="comment">// set acceleration or velocity limit</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>: </div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> ( !motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="comment">// store limit input from command</span></div><div class="line">                    limit_in = atoi(&amp;input[3]);</div><div class="line">                    </div><div class="line">                    <span class="keywordflow">switch</span>(input[2]){</div><div class="line">                        <span class="comment">// velocity limit</span></div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div><div class="line">                            <span class="comment">//verify limit is valid, store, then propagate the change to the motor</span></div><div class="line">                            <span class="keywordflow">if</span> (MIN_VEL_LIMIT&lt;=limit_in &amp;&amp; limit_in&lt;=MAX_VEL_LIMIT){</div><div class="line">                                velocityLimits[motorNum_in] = limit_in;</div><div class="line">                                motors[motorNum_in]-&gt;VelMax(velocityLimits[motorNum_in]);</div><div class="line">                                SendFeedback(FB_COMMAND_OK);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                SendFeedback(FB_ERR_LIMIT_OUT_OF_BOUNDS);</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                            </div><div class="line">                        <span class="comment">// acceleration limit</span></div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line">                        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div><div class="line">                            <span class="comment">//verify limit is valid, store, then propagate the change to the motor</span></div><div class="line">                            <span class="keywordflow">if</span> (MIN_ACCEL_LIMIT&lt;=limit_in &amp;&amp; limit_in&lt;=MAX_ACCEL_LIMIT){</div><div class="line">                                accelerationLimits[motorNum_in] = limit_in;</div><div class="line">                                motors[motorNum_in]-&gt;AccelMax(velocityLimits[motorNum_in]);</div><div class="line">                                SendFeedback(FB_COMMAND_OK);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                SendFeedback(FB_ERR_LIMIT_OUT_OF_BOUNDS);</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                            </div><div class="line">                        <span class="comment">// invalid limit request</span></div><div class="line">                        <span class="keywordflow">default</span>:</div><div class="line">                            SendFeedback(FB_ERR_INVALID_LIMIT_REQUEST);</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="comment">// clear alerts</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    </div><div class="line">                    <span class="comment">// capture the current state of enable </span></div><div class="line">                    <span class="comment">//  this value will be restored after alerts are cleared</span></div><div class="line">                    motorEnabledBeforeClearingAlerts = motors[motorNum_in]-&gt;EnableRequest();</div><div class="line">                    </div><div class="line">                    <span class="comment">// to clear all ClearCore alerts (which can include motor faults): </span></div><div class="line">                    <span class="comment">//  - cycle enable if faults present (clears faults, if any)</span></div><div class="line">                    <span class="comment">//  - clear alert register (clears alerts)</span></div><div class="line">                    <span class="comment">// this command clears both ClearCore motor alerts and motor faults</span></div><div class="line">                    <span class="keywordflow">if</span> (statusReg.bit.MotorInFault){ </div><div class="line">                        motors[motorNum_in]-&gt;EnableRequest(<span class="keyword">false</span>);</div><div class="line">                        <a class="code" href="_sys_timing_8h.html#a1d3146414c54513a72a7596c2f884c07">Delay_ms</a>(10);</div><div class="line">                        <span class="keywordflow">if</span>(motorEnabledBeforeClearingAlerts){</div><div class="line">                            motors[motorNum_in]-&gt;EnableRequest(<span class="keyword">true</span>);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    motors[motorNum_in]-&gt;ClearAlerts();</div><div class="line">                    SendFeedback(FB_COMMAND_OK);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                    </div><div class="line">                <span class="comment">// set the zero position for motor # to the current commanded position</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;z&#39;</span>:</div><div class="line">                    <span class="comment">// verify motor number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!motorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_MOTOR_NUM_INVALID);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="comment">// zero position</span></div><div class="line">                    motors[motorNum_in]-&gt;PositionRefSet(0);</div><div class="line">                    SendFeedback(FB_COMMAND_OK);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="comment">// read input from ClearCore connector </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div><div class="line">                    <span class="comment">// verify connector number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!connectorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_CONNECTOR_NUM_INVALID);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="comment">// verify connector mode valid</span></div><div class="line">                    <span class="keywordflow">if</span> (connectors[connectorNum_in]-&gt;Mode() != Connector::INPUT_DIGITAL &amp;&amp; </div><div class="line">                        connectors[connectorNum_in]-&gt;Mode() != Connector::INPUT_ANALOG){</div><div class="line">                        SendFeedback(FB_ERR_CONNECTOR_MODE_INCOMPATIBLE); </div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    inputConnectorValue = connectors[connectorNum_in]-&gt;State();</div><div class="line">                    <span class="keywordflow">if</span>(verboseFeedback){</div><div class="line">                        ioPort.Send(<span class="stringliteral">&quot;Connector &quot;</span>);</div><div class="line">                        ioPort.Send(connectorNum_in);</div><div class="line">                        ioPort.Send(<span class="stringliteral">&quot; value: &quot;</span>);</div><div class="line">                    }</div><div class="line">                    ioPort.SendLine(inputConnectorValue);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                </div><div class="line">                </div><div class="line">                <span class="comment">// write digital output to ClearCore digital output connector </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div><div class="line">                    <span class="comment">// verify connector number valid</span></div><div class="line">                    <span class="keywordflow">if</span> (!connectorNumValid){</div><div class="line">                        SendFeedback(FB_ERR_CONNECTOR_NUM_INVALID); </div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="comment">// verify connector type valid</span></div><div class="line">                    <span class="keywordflow">if</span> (connectors[connectorNum_in]-&gt;Mode() != Connector::OUTPUT_DIGITAL &amp;&amp; </div><div class="line">                        connectors[connectorNum_in]-&gt;Mode() != Connector::OUTPUT_ANALOG){</div><div class="line">                        SendFeedback(FB_ERR_CONNECTOR_MODE_INCOMPATIBLE); </div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="comment">// store and write value</span></div><div class="line">                    outputConnectorValue_in = atoi(&amp;input[3]);</div><div class="line">                    <span class="keywordflow">if</span>(!connectors[connectorNum_in]-&gt;State(outputConnectorValue_in)){</div><div class="line">                        SendFeedback(FB_ERR_IO_OUTPUT);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        SendFeedback(FB_COMMAND_OK);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                </div><div class="line">                </div><div class="line">                <span class="comment">// change feedback type </span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line">                    <span class="keywordflow">switch</span>(atoi(&amp;input[1])){</div><div class="line">                        </div><div class="line">                        <span class="comment">// feedback number only</span></div><div class="line">                        <span class="keywordflow">case</span> 0:</div><div class="line">                            verboseFeedback = <span class="keyword">false</span>;</div><div class="line">                            SendFeedback(FB_COMMAND_OK);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                        </div><div class="line">                        <span class="comment">// verbose feedback messages</span></div><div class="line">                        <span class="keywordflow">case</span> 1:</div><div class="line">                            verboseFeedback = <span class="keyword">true</span>;</div><div class="line">                            SendFeedback(FB_COMMAND_OK);</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                        </div><div class="line">                        <span class="comment">// invalid feedback request</span></div><div class="line">                        <span class="keywordflow">default</span>:</div><div class="line">                            SendFeedback(FB_ERR_INVALID_FEEDBACK_OPTION);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="comment">// help</span></div><div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div><div class="line">                    SendFeedback(FB_HELP);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                <span class="comment">// invalid command letter</span></div><div class="line">                <span class="keywordflow">default</span>:</div><div class="line">                    SendFeedback(FB_ERR_UNRECOGNIZED_COMMAND);</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            } <span class="comment">// switch(command letter)</span></div><div class="line">        } <span class="comment">// if (inputValid)</span></div><div class="line">    } <span class="comment">// while(true)</span></div><div class="line">} <span class="comment">// main()</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"> * SendFeedback</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *    Helper function to send feedback for specified feedback message.</span></div><div class="line"><span class="comment"> *   </span></div><div class="line"><span class="comment"> * Parameters:</span></div><div class="line"><span class="comment"> *    int messageNumber - The feedback identification number corresponding the </span></div><div class="line"><span class="comment"> *          feedback struct array index</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Returns: None (feedback message is sent directly to output)</span></div><div class="line"><span class="comment">*/</span></div><div class="line"> <span class="keywordtype">void</span> SendFeedback(int32_t messageNumber){</div><div class="line">    <span class="comment">// send either the verbose message or only the message number, based on verboseFeedback bool</span></div><div class="line">    <span class="keywordflow">if</span> (verboseFeedback){</div><div class="line">        ioPort.SendLine(FeedbackMessages[messageNumber].message);</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        ioPort.SendLine(FeedbackMessages[messageNumber].number);</div><div class="line">    }</div><div class="line"> } <span class="comment">// SendFeedback()</span></div><div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*------------------------------------------------------------------------------</span></div><div class="line"><span class="comment"> * SendVerboseStatus</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *    Outputs verbose status information. </span></div><div class="line"><span class="comment"> *    Functionality adapted from MotorStatusRegister example project</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Parameters:</span></div><div class="line"><span class="comment"> *    int motorNumber  - The motor whose status should be printed</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Returns: None (status message is sent directly to output)</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keywordtype">void</span> SendVerboseStatus(int32_t motorNumber) {</div><div class="line">    <span class="comment">// status register for accessing motor status information</span></div><div class="line">    <span class="keyword">volatile</span> <span class="keyword">const</span> MotorDriver::StatusRegMotor &amp;statusReg = motors[motorNumber]-&gt;StatusReg();</div><div class="line">    <span class="keyword">volatile</span> <span class="keyword">const</span> MotorDriver::AlertRegMotor &amp;alertReg = motors[motorNumber]-&gt;AlertReg();</div><div class="line">    </div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;Motor status register for motor M&quot;</span>);</div><div class="line">    ioPort.Send(motorNumber);</div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;: &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.reg, 2); <span class="comment">// prints the status register in binary</span></div><div class="line">    </div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;AtTargetPosition:  &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.AtTargetPosition);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;StepsActive:       &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.StepsActive);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;AtTargetVelocity:  &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.AtTargetVelocity);</div><div class="line">        </div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;MoveDirection:     &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.MoveDirection);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;MotorInFault:      &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.MotorInFault);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;Enabled:           &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.Enabled);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;PositionalMove:    &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.PositionalMove);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;HLFB State:        &quot;</span>);</div><div class="line">    <span class="keywordflow">switch</span> (statusReg.bit.HlfbState) {</div><div class="line">        <span class="keywordflow">case</span> 0:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;HLFB_DEASSERTED&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 1:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;HLFB_ASSERTED&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 2:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;HLFB_HAS_MEASUREMENT&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 3:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;HLFB_UNKNOWN&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="comment">// something has gone wrong if this is printed</span></div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;???&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;AlertsPresent:     &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.AlertsPresent);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;Ready state:       &quot;</span>);</div><div class="line">    <span class="keywordflow">switch</span> (statusReg.bit.ReadyState) {</div><div class="line">        <span class="keywordflow">case</span> MotorDriver::MOTOR_DISABLED:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;Disabled&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> MotorDriver::MOTOR_ENABLING:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;Enabling&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> MotorDriver::MOTOR_FAULTED:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;Faulted&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> MotorDriver::MOTOR_READY:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;Ready&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> MotorDriver::MOTOR_MOVING:</div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;Moving&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="comment">// something has gone wrong if this is printed</span></div><div class="line">            ioPort.SendLine(<span class="stringliteral">&quot;???&quot;</span>);</div><div class="line">    }</div><div class="line">    </div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;Triggering:        &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.Triggering);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;InPositiveLimit:   &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.InPositiveLimit);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;InNegativeLimit:   &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.InNegativeLimit);</div><div class="line"></div><div class="line">    ioPort.Send(<span class="stringliteral">&quot;InEStopSensor:     &quot;</span>);</div><div class="line">    ioPort.SendLine(statusReg.bit.InEStopSensor);   </div><div class="line"></div><div class="line">    ioPort.SendLine(<span class="stringliteral">&quot;--------------------------------&quot;</span>);</div><div class="line">    </div><div class="line">        </div><div class="line">    <span class="keywordflow">if</span> (statusReg.bit.AlertsPresent){</div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;Alert register:    &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.reg, 2); <span class="comment">// prints the alert register in binary</span></div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotionCanceledInAlert:         &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotionCanceledInAlert);</div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotionCanceledPositiveLimit:   &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotionCanceledPositiveLimit);</div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotionCanceledNegativeLimit:   &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotionCanceledNegativeLimit);</div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotionCanceledSensorEStop:     &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotionCanceledSensorEStop);</div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotionCanceledMotorDisabled:   &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotionCanceledMotorDisabled);</div><div class="line"></div><div class="line">        ioPort.Send(<span class="stringliteral">&quot;MotorFaulted:                  &quot;</span>);</div><div class="line">        ioPort.SendLine(alertReg.bit.MotorFaulted);</div><div class="line"></div><div class="line">        ioPort.SendLine(<span class="stringliteral">&quot;--------------------------------&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">}<span class="comment">// SendVerboseStatus()</span></div><div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
