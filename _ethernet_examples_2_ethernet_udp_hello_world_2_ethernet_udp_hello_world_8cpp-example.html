<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ClearCore Library: EthernetExamples/EthernetUdpHelloWorld/EthernetUdpHelloWorld.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ClearCore Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EthernetExamples/EthernetUdpHelloWorld/EthernetUdpHelloWorld.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Return to <a class="el" href="SdkExamples.html">SDK Examples for Microchip Studio</a></p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Title: EthernetUdpHelloWorld</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Objective:</span></div><div class="line"><span class="comment"> *    This example demonstrates how to enable Ethernet functionality to send and</span></div><div class="line"><span class="comment"> *    receive UDP datagrams (packets).</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Description:</span></div><div class="line"><span class="comment"> *    This example will set up ethernet communications between a ClearCore and</span></div><div class="line"><span class="comment"> *    another Ethernet source (a PC or ClearCore). The example then prints the</span></div><div class="line"><span class="comment"> *    contents of the packets received to the specified serial port and sends</span></div><div class="line"><span class="comment"> *    a &quot;Hello World&quot; response to the sender.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Requirements:</span></div><div class="line"><span class="comment"> * ** Setup 1 (ClearCore and a PC): The PC should be running software capable</span></div><div class="line"><span class="comment"> *    of sending and receiving UDP packets. PacketSender is highly recommended</span></div><div class="line"><span class="comment"> *    as a free, cross-platform software. Configure PacketSender to send a UDP</span></div><div class="line"><span class="comment"> *    packet to the ClearCore by specifying the IP address and port provided to</span></div><div class="line"><span class="comment"> *    EthernetMgr.LocalIp(). Your firewall or network settings may need to be</span></div><div class="line"><span class="comment"> *    adjusted in order to receive the response back from the ClearCore.</span></div><div class="line"><span class="comment"> * ** Setup 2 (ClearCore to a ClearCore): A partner sketch is included at the</span></div><div class="line"><span class="comment"> *    end of this file that can be used on the other ClearCore. The MAC address</span></div><div class="line"><span class="comment"> *    and IP address values set up for each ClearCore must be unique. The remote</span></div><div class="line"><span class="comment"> *    IP address and port used in the partner sketch must match the IP address</span></div><div class="line"><span class="comment"> *    and port used to setup the ClearCore in this sketch.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Links:</span></div><div class="line"><span class="comment"> * ** ClearCore Documentation: https://teknic-inc.github.io/ClearCore-library/</span></div><div class="line"><span class="comment"> * ** ClearCore Manual: https://www.teknic.com/files/downloads/clearcore_user_manual.pdf</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * Copyright (c) 2020 Teknic Inc. This work is free to use, copy and distribute under the terms of</span></div><div class="line"><span class="comment"> * the standard MIT permissive software license which can be found at https://opensource.org/licenses/MIT</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &quot;ClearCore.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;EthernetUdp.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Change the IP address below to match your ClearCore&#39;s IP address.</span></div><div class="line">IpAddress ip = IpAddress(192, 168, 1, 177);</div><div class="line"></div><div class="line"><span class="comment">// The local port to listen for connections on.</span></div><div class="line">uint16_t localPort = 8888;</div><div class="line"></div><div class="line"><span class="comment">// The maximum number of characters to receive from an incoming packet</span></div><div class="line"><span class="preprocessor">#define MAX_PACKET_LENGTH 100</span></div><div class="line"><span class="comment">// Buffer for holding received packets.</span></div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> packetReceived[MAX_PACKET_LENGTH];</div><div class="line"></div><div class="line"><span class="comment">// The Ethernet UDP object to let us send and receive packets over UDP</span></div><div class="line">EthernetUdp Udp;</div><div class="line"></div><div class="line"><span class="comment">// Set this false if not using DHCP to configure the local IP address.</span></div><div class="line"><span class="keywordtype">bool</span> usingDhcp = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">    <span class="comment">// Set up serial communication at a baud rate of 9600 bps then wait up to</span></div><div class="line">    <span class="comment">// 5 seconds for a port to open.</span></div><div class="line">    <span class="comment">// Serial communication is not required for this example to run, however the</span></div><div class="line">    <span class="comment">// example will appear to do nothing without serial output.</span></div><div class="line">    <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a name="a0"></a><a class="code" href="class_clear_core_1_1_serial_usb.html#a5b1cd4915ad14023751612beb4a03cc6">Mode</a>(Connector::USB_CDC);</div><div class="line">    <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a name="a1"></a><a class="code" href="class_clear_core_1_1_i_serial.html#a7515df93959e401a66ecad383489f3a7">Speed</a>(9600);</div><div class="line">    <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a name="a2"></a><a class="code" href="class_clear_core_1_1_serial_usb.html#a561c742258bb80eefd94946717144aed">PortOpen</a>();</div><div class="line"></div><div class="line">    uint32_t timeout = 5000;</div><div class="line">    uint32_t startTime = <a name="a3"></a><a class="code" href="_sys_timing_8h.html#ad2e3af14d09a6ffc7065828caf2a59c6">Milliseconds</a>();</div><div class="line">    <span class="keywordflow">while</span> (!ConnectorUsb &amp;&amp; <a class="code" href="_sys_timing_8h.html#ad2e3af14d09a6ffc7065828caf2a59c6">Milliseconds</a>() - startTime &lt; timeout) {</div><div class="line">        <span class="keywordflow">continue</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Make sure the physical link is up before continuing.</span></div><div class="line">    <span class="keywordflow">while</span> (!<a class="code" href="namespace_clear_core.html#ab9b9a29bc36dde08f25dd3f4a05c7a71">EthernetMgr</a>.<a name="a4"></a><a class="code" href="class_clear_core_1_1_ethernet_manager.html#a2b3b1957bc457faf9e6287b4cca926f8">PhyLinkActive</a>()) {</div><div class="line">        <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a name="a5"></a><a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(<span class="stringliteral">&quot;The Ethernet cable is unplugged...&quot;</span>);</div><div class="line">        <a name="a6"></a><a class="code" href="_sys_timing_8h.html#a1d3146414c54513a72a7596c2f884c07">Delay_ms</a>(1000);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Run the setup for the ClearCore Ethernet manager.</span></div><div class="line">    <a class="code" href="namespace_clear_core.html#ab9b9a29bc36dde08f25dd3f4a05c7a71">EthernetMgr</a>.<a name="a7"></a><a class="code" href="class_clear_core_1_1_ethernet_manager.html#ac2ad04c16266f9de35d6f250d74ffb91">Setup</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (usingDhcp) {</div><div class="line">        <span class="comment">// Use DHCP to configure the local IP address.</span></div><div class="line">        <span class="keywordtype">bool</span> dhcpSuccess = <a class="code" href="namespace_clear_core.html#ab9b9a29bc36dde08f25dd3f4a05c7a71">EthernetMgr</a>.<a name="a8"></a><a class="code" href="class_clear_core_1_1_ethernet_manager.html#ac1d6d902e5dc391a556e054c6924e307">DhcpBegin</a>();</div><div class="line">        <span class="keywordflow">if</span> (dhcpSuccess) {</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a name="a9"></a><a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;DHCP successfully assigned an IP address: &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(<a class="code" href="namespace_clear_core.html#ab9b9a29bc36dde08f25dd3f4a05c7a71">EthernetMgr</a>.<a name="a10"></a><a class="code" href="class_clear_core_1_1_ethernet_manager.html#a47d7bd98cf202ef7c7fab10b80fa5d63">LocalIp</a>().<a name="a11"></a><a class="code" href="class_clear_core_1_1_ip_address.html#aaefeef465c0a10472195d6fb4e97332f">StringValue</a>());</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> {</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(<span class="stringliteral">&quot;DHCP configuration was unsuccessful!&quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(<span class="stringliteral">&quot;Try again using a manual configuration...&quot;</span>);</div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="comment">// UDP will not work without a configured IP address.</span></div><div class="line">                <span class="keywordflow">continue</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> {</div><div class="line">        <a class="code" href="namespace_clear_core.html#ab9b9a29bc36dde08f25dd3f4a05c7a71">EthernetMgr</a>.<a class="code" href="class_clear_core_1_1_ethernet_manager.html#a47d7bd98cf202ef7c7fab10b80fa5d63">LocalIp</a>(ip);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Begin listening on the local port for UDP datagrams</span></div><div class="line">    Udp.Begin(localPort);</div><div class="line"></div><div class="line">    <span class="comment">// This loop will wait to receive a packet from a remote source, then reply</span></div><div class="line">    <span class="comment">// back with a packet containing a &quot;Hello, world!&quot; message.</span></div><div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">        <span class="comment">// Look for a received packet.</span></div><div class="line">        uint16_t packetSize = Udp.PacketParse();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (packetSize &gt; 0) {</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;Received packet of size &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(packetSize);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(<span class="stringliteral">&quot; bytes.&quot;</span>);</div><div class="line"></div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;Remote IP: &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(Udp.RemoteIp().StringValue());</div><div class="line"></div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;Remote port: &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(Udp.RemotePort());</div><div class="line"></div><div class="line">            <span class="comment">// Read the packet.</span></div><div class="line">            int32_t bytesRead = Udp.PacketRead(packetReceived, MAX_PACKET_LENGTH);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;Number of bytes read from packet: &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>(bytesRead);</div><div class="line"></div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#aa609f4a056cecb71d7ebe13fc74937fd">Send</a>(<span class="stringliteral">&quot;Packet contents: &quot;</span>);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>((<span class="keywordtype">char</span> *)packetReceived);</div><div class="line">            <a class="code" href="namespace_clear_core.html#a8ccd6f747ff7edf425878f3ae20b311d">ConnectorUsb</a>.<a class="code" href="class_clear_core_1_1_i_serial.html#a0928b2e44a4f0432f5caa72a47c3db7f">SendLine</a>();</div><div class="line"></div><div class="line">            <span class="comment">// Send a &quot;Hello, world!&quot; reply packet back to the sender.</span></div><div class="line">            Udp.Connect(Udp.RemoteIp(), Udp.RemotePort());</div><div class="line">            Udp.PacketWrite(<span class="stringliteral">&quot;Hello, world!&quot;</span>);</div><div class="line">            Udp.PacketSend();</div><div class="line">        }</div><div class="line"></div><div class="line">        <a class="code" href="_sys_timing_8h.html#a1d3146414c54513a72a7596c2f884c07">Delay_ms</a>(10);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">  // ---------------------------------</span></div><div class="line"><span class="comment">  // Partner ClearCore Example Sketch</span></div><div class="line"><span class="comment">  // ---------------------------------</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">#include &quot;ClearCore.h&quot;</span></div><div class="line"><span class="comment">#include &quot;EthernetUdp.h&quot;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// Change the IP address below to match this ClearCore&#39;s IP address.</span></div><div class="line"><span class="comment">IpAddress ip = IpAddress(192, 168, 1, 178);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// The local port to listen for connections on.</span></div><div class="line"><span class="comment">uint16_t localPort = 8888;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// The remote ClearCore&#39;s IP address and port</span></div><div class="line"><span class="comment">IpAddress remoteIp = IpAddress(192, 168, 1, 177);</span></div><div class="line"><span class="comment">uint16_t remotePort = 8888;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// The last time you sent a packet to the remote device, in milliseconds.</span></div><div class="line"><span class="comment">uint32_t lastSendTime = 0;</span></div><div class="line"><span class="comment">// Delay between sending packets, in milliseconds</span></div><div class="line"><span class="comment">const uint32_t sendingInterval = 10 * 1000;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// An EthernetUDP instance to let us send and receive packets over UDP</span></div><div class="line"><span class="comment">EthernetUdp Udp;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">// Set this false if not using DHCP to configure the local IP address.</span></div><div class="line"><span class="comment">bool usingDhcp = true;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">int main() {</span></div><div class="line"><span class="comment">    // Set up serial communication at a baud rate of 9600 bps then wait up to</span></div><div class="line"><span class="comment">    // 5 seconds for a port to open.</span></div><div class="line"><span class="comment">    // Serial communication is not required for this example to run, however the</span></div><div class="line"><span class="comment">    // example will appear to do nothing without serial output.</span></div><div class="line"><span class="comment">    ConnectorUsb.Mode(Connector::USB_CDC);</span></div><div class="line"><span class="comment">    ConnectorUsb.Speed(9600);</span></div><div class="line"><span class="comment">    ConnectorUsb.PortOpen();</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    // Run the setup for the ClearCore Ethernet manager.</span></div><div class="line"><span class="comment">    EthernetMgr.Setup();</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    if (usingDhcp) {</span></div><div class="line"><span class="comment">        // Use DHCP to configure the local IP address</span></div><div class="line"><span class="comment">        bool dhcpSuccess = EthernetMgr.DhcpBegin();</span></div><div class="line"><span class="comment">        if (dhcpSuccess) {</span></div><div class="line"><span class="comment">            ConnectorUsb.Send(&quot;DHCP successfully assigned an IP address: &quot;);</span></div><div class="line"><span class="comment">            ConnectorUsb.SendLine(EthernetMgr.LocalIp().StringValue());</span></div><div class="line"><span class="comment">        }</span></div><div class="line"><span class="comment">        else {</span></div><div class="line"><span class="comment">            ConnectorUsb.SendLine(&quot;DHCP configuration was unsuccessful!&quot;);</span></div><div class="line"><span class="comment">            ConnectorUsb.SendLine(&quot;Try again using a manual configuration...&quot;);</span></div><div class="line"><span class="comment">            while (true) {</span></div><div class="line"><span class="comment">                // UDP will not work without a configured IP address.</span></div><div class="line"><span class="comment">                continue;</span></div><div class="line"><span class="comment">            }</span></div><div class="line"><span class="comment">        }</span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment">    else {</span></div><div class="line"><span class="comment">        EthernetMgr.LocalIp(ip);</span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    // Make sure the physical link is up before continuing.</span></div><div class="line"><span class="comment">    while (!EthernetMgr.PhyLinkActive()) {</span></div><div class="line"><span class="comment">        ConnectorUsb.SendLine(&quot;The Ethernet cable is unplugged...&quot;);</span></div><div class="line"><span class="comment">        Delay_ms(1000);</span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    // Begin listening on the local port for UDP datagrams</span></div><div class="line"><span class="comment">    Udp.Begin(localPort);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    // This loop will send a packet to the remote IP and port specified every</span></div><div class="line"><span class="comment">    // 10 seconds.</span></div><div class="line"><span class="comment">    while (true) {</span></div><div class="line"><span class="comment">        // Wait for 10 seconds.</span></div><div class="line"><span class="comment">        if (Milliseconds() - lastSendTime &gt; sendingInterval) {</span></div><div class="line"><span class="comment">            Udp.Connect(remoteIp, remotePort);</span></div><div class="line"><span class="comment">            Udp.PacketWrite(&quot;Hello ClearCore.&quot;);</span></div><div class="line"><span class="comment">            Udp.PacketSend();</span></div><div class="line"><span class="comment">            lastSendTime = Milliseconds();</span></div><div class="line"><span class="comment">        }</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">        // Keep the connection alive.</span></div><div class="line"><span class="comment">        EthernetMgr.Refresh();</span></div><div class="line"><span class="comment">    }</span></div><div class="line"><span class="comment">}</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
